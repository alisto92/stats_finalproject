---
title: 'Lab 3: Draft Report'
author: "Priscilla Burity, Oscar Linares, Alissa Stover"
date: "3/31/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Executive Summary

TBD

# Introduction

Which policies are most promising in reducing the crime rate: economic (e.g., increasing wages) or classic criminal deterrants (e.g., increasing arrests) (or both together)? What is the influence of contextual factors (e.g., characteristics of a population) on these relationships? 

We have a cross-section data on crime statistics and indicators that can influence crime rates for a selection of counties in North Carolina. Our task is to examine the data to help a political campaign understand the determinants of crime and generate policy suggestions that are applicable to local government.

We will be modeling our target variable (crime rate, `crmrte`) using candidates of policy variables that represent different economic and criminal justice indicators that can be influenced via various policy decisions taken by our candidate. 

We also include a range of contextual variables that help to control for local characteristics (for example, demographic and geographic indicators) that could influence crime and the efficacy of these policies but are not actionable by a local government. We aim to produce a model robust to these, that can help guide policy decisions and help reduce crime across these counties. 

## Actionable Variables

### Criminal Justice Policy

These variables describe things we could affect with policy around the criminal justice system. Many of these policies are used as deterrants of crime, with the assumption being that people inherently understand that these punishments exist and as such will be less likely to commit crimes (in order to avoid the punishment). 

Please note that the 3 variables below are dubbed "probabilities". However, this is a misnomer as these variables are truly ratios (e.g., the ratio of arrests to crimes reported). We interpret these as measures of the assertiveness of the criminal justice system in a county. Ideally, we would want to strike a balance between arresting enough people to prevent criminal activity, and not arresting so many as to abuse the populace.

*Probability of arrest* 

If we find that the assertiveness of arrest is associated with crime rate (with higher punishment associated with lower crime), we may consider stricter policies around police practice that encourage more arrests. 

- `prbarr`: number of convictions for every crime reported

*Probability of conviction* 

If we find that the assertiveness of conviction is associated with crime rate (with higher conviction rates associted with lower crime), we may consider stricter policies around court practices so that more arrests lead to convictions.

- `prbconv`: number of convictions for every arrest made

*Probability of sentencing* 

If we find that the assertiveness of sentencing is associated with crime rate (with higher sentencing rates associted with lower crime), we may consider stricter policies around judicial practices so that more convictions lead to sentencing. However, whether or not a given conviction carries a prison sentence depends on the severity of the crime. Thus, this variable may be more limited in its explanatory power than arrests and convictions. 

- `prbpris`: number of prison sentences for every conviction

*Severity of punishment* 

If we find that the severity of punishment is associated with crime rate (with greater severity associted with lower crime), we may consider stricter policies around judicial practices so that people receive more severe punishments if sentenced with a crime.

- `avgsen`:	avg. sentence, days 

*Number of police officers per capita*

The number of police officers per capita (measured by the variable `polpc`) is a very intuitive example of crime deterrant, as it in theory increases the likelyhood of being caught in the act of the crime and is also a measure of the capacity of the State to enforce the law.

As our job is to advise a policy maker, it’s very important that we feel safe about the causal interpretation of our findings. After all, the idea is to propose policies with a significant impact on people’s lives. Thus, for statistical rigor, we need to make sure that causal effects go one way (that we have reason to believe that our independent variables have causal effects on our dependent variables, and not the reverse). 

A cross section of counties though does not allow us to link police presence to crime rates with a causal interpretation. This is because one can expect the counties with larger crime rates in a year *t* would consider necessary to have a larger number of police officers on the streets in year *t*, which can imply a positive correlation between presence of police and crime rates that couldn't be read as police presence leading to *higher* crime rates. In fact, an increase in crime could result in an increase in the number of police officers *and* an increase in police officers could result in a decrease in crime. 

Thus, in this exercise we opted not to include police per capita as a candidate policy variable or covariate. 

### Economic Policy

# Add more about operationalization of wages

These variables describe things we could affect with economic policy. For example, if increased wages are found to be related significantly to crime, our candidate could consider strategies such as raising the minimum wage in an attempt to lower crime. These variables speak to wages for different sectors.

- `wcon`:	weekly wage, construction
- `wtuc`:	wkly wge, trns, util, commun
- `wtrd`:	wkly wge, whlesle, retail trade
- `wfir`:	wkly wge, fin, ins, real est
- `wser`:	wkly wge, service industry
- `wmfg`:	wkly wge, manufacturing
- `wsta`:	wkly wge, state employees
- `wloc`:	wkly wge, local gov emps

The following federal wage variable will be grouped with other wages in much of our analyses for easier comparison in terms of data quality, however it is not related to minimum wage policy but rather to cost of living. Federal employee wages are adjusted by cost of living in a locality (https://www.opm.gov/policy-data-oversight/pay-leave/salaries-wages/fact-sheets/); thus, this variable could also be used as a marker of cost of living in a county. Cost of living is related to overall wealth in an area and its overall econimic development. If we find a relationship between federal wages and crime, one could predict that changing the economic development of a region may affect crime. However, this variable is confounded by the types of federal workers in an area, since federal wages are determined by a grade system that is tied to the nature of the position and time in position. A specific effort that could affect both of these - bringing more economic development and the right types of high-earning federal employees - would be to attract federal jobs to the area that have higher wages. 

- `wfed`:	wkly wge, fed employees

The following variable represents tax policy, but it could also reflect overall wealth in a county. Holding tax rate constant, counties with more wealth will have more tax revenue and vice versa. Holding wealth constant, changing the tax rate would change the tax revenue per capita. A better measure of tax policy would be the actual tax rates in each county. Since the impact of policy on this variable is confounded by the overal wealth in a county, the causal relationship would be difficult to interpret. Plus, many taxes are set at the state and federal level; the level of variation at the county-level may be limited for a small state like North Carolina. However, similar to `wfed`, this variable would be related to overall economic development. If we found a relationship between tax revenue and crime rate, it would make sense to try to change development efforts in order to affect crime.  

- `taxpc`:	tax revenue per capita 

## Contextual Variables

Since we are aiming to produce policy recommendations, the following variables may be helpful in our analysis but are not necessarily actionable. They describe county characteristics that provide important information about how policies could work across different county contexts.

### Types of Crime 

- `mix`:	offense mix: face-to-face/other

### Demographics 

The following variables describe different aspects of the people that reside in these counties.

*Urban/rural dwellers* 

- `density`:	people per sq. mile 

*Minority status*

- `pctmin80`:	perc. minority, 1980 

*Gender & Age* (young males are more likely to enter the criminal justice system)

- `pctymle`:	percent young male 


### Geography

The following variables identify which region of the state each county is in, with the assumption that counties cluster geographically in terms of their culture and other characteristics we are not explicitly measuring. Western North Carolina is along the Appalachian mountains and seems qualitatively different from much of the rest of the state. For example, it has much fewer universities compared to the rest of the state (you can see this through a quick Google Maps search). Thus, we will lean towards using `west` over the other geographical variables (especially since `urban` could be highly related to `density`). 

- `west`:	=1 if in western N.C.
- `central`:	=1 if in central N.C.
- `urban`:	=1 if in SMSA

# A Model Building Process

## Data Cleaning

### Environment

#### Import Libraries 

```{r, message=FALSE}
library(tidyverse) # for data import, manipulation, viz
library(corrplot) # for correlation matix
library(stargazer) # visualize model fit
library(skimr) # generate summary statistics
library(car) # statistics 
library(lmtest) # linear modeling
library(olsrr) # evaluating OLS regression 
library(sandwich) # correcting heteroskedasticity violation
library(grid) # to arrange ggplot figures into a grid 
library(gridExtra) # to arrange ggplot figures into a grid 
```

#### Import Data

We are importing a CSV file into R. The argument `n_max` is set to the number of rows of data we are provided (91). 

```{r, message=FALSE}
data <- read_csv("crime_v2.csv", n_max = 91)
```

#### Exploratory Data Analysis: File-level data checks

Let's take a visual check of our data. We have 91 observations and 25 columns. This is what we expected based on our original csv file. 

```{r}
head(data)
```

```{r}
print(paste("Number of records:", dim(data)[1]))
print(paste("Number of variables:", dim(data)[2]))
```

All 25 columns are numeric. 

```{r}
str(data)
```

##### The Where & When of these data 

It looks like we usually have 1 observation for each of the counties -- except for county #193. We do not have any missing values in the `county` column. 

```{r}
length(unique(data$county))
table(data$county, useNA = "always")
```

Having 2 observations for county #193 is surprising. We can see that these rows appear to be exact duplicates. 

```{r}
data %>% filter(county == 193)
```

What else can we glean from the county variable? It appears as though these county IDs could be county FIPS codes. One can see a list here: https://www.lib.ncsu.edu/gis/countfips 

We cannot make assumptions about this, however we can try to supplement some of our data quality checks to see if anything seems to align between the IDs of our counties and their FIPS codes. 

Another thing to note is that we seem to be missing information from 10 of the 100 counties in North Carolina.

We can see that `year` appears to be constant (which is expected). We also don't have any missing values for this column. We can drop this column in future data processing steps. 

```{r}
table(data$year, useNA = "always")
```

Based on the explorations above, we create a new data frame that has dropped our superfluous column (`year`) and the superfluous row (duplicate of county 193). 

```{r}
data2 <- data %>% distinct() %>% select(-c("year", "polpc"))
```

Now we have 90 rows and 24 variables, with one observation per county.

```{r}
length(unique(data2$county)) == length(data2$county) # check 1 obs per county
str(data2) # examine dataframe 
```

##### Missingness & Data Validity

We can see from the following table that we don't have any missing data, which is good! 

However, we can see by the max for each column (p100), that we appear to have a few values that are extremely high. 

For example, one county has weekly wages in the service sector reported to be \$2177.07 (almost 10x the mean of \$275.34). 

```{r}
data2_skim <- skim(data2)
data2_skim
```

Note that `pctmin80` values are not in the [0,1] scale despite being a percentage of total metric. The scale for this variable seems to had been adjusted and it is not matching the rest of percetange metrics in our data set. This difference could be due to the fact that `pctmin80` came from a different source. The scale of `pctmin80` will be adjusted in order to facilitate coefficient interpretation.

```{r}
data2$pctmin80 <- data2$pctmin80 * 0.01
```


##### Preserve Clean Data

Save our clean data set

```{r}
save(data2, file = "data_clean.rda")
```

## Exploratory Data Analysis: Variable-level data checks

### Dependent Variable: Crime Rate

Barring extreme issues with `crmrte` (crime rate), we would recommend focusing on this as our target variable, as what matters most to people is the level of crime around them every day. The justice system is used to enact justice and to deter crimes. Justice is important, and making sure that those that commit crimes are punished is one way of going about achieving a just and safer society. Of course, justice is a moral issue and can be seen from many different lenses, but the data we have in hands do not allow us to go in depth in this issue. 

We don't have enough data points to make a strong claim about the distribution of `crmtre`, however it appears to be approximately normal (with a slight skew which could be an artifact of not having any values below 0). 

From our box plot we can see that most values are between 0.02 and 0.04, however we do have a range of values including some that are close to 0.10. We don't appear to have any spurious values. 

```{r, fig.width = 6, fig.align = "center"}
p1 <- ggplot(data2, aes(crmrte)) +
  geom_histogram(bins = 35) +
  theme_minimal() +
  xlab("Crime Rate") +
  ylab("Count") +
  ggtitle("Histogram")

p2 <- ggplot(data2, aes(y = crmrte)) +
  geom_boxplot() +
  theme_minimal() +
  ylab("Crime Rate") +
  ggtitle("Box plot")

grid.arrange(p1, p2, ncol = 2, top = "Candidate Dependent Variable: Crime Rate")
```

Our preferred variable (`crmrte`) appears to be of sufficient quality for our analyses and thus we will use it as our dependent variable. 

### Independent Variables 

#### Actionable Variables

##### Criminal Justice Policy

As noted above, we combined our 3 core criminal justice policy variables (`prbarr`, `prbconv`, `prbpris`) into one measure of the assertiveness of the criminal justice system. It is a combined measure of the ratio of arrests, convictions, and prison sentences to crimes. It could be interesting to the policy maker to check how these criminal justice indicators work together preventing crime.    

First, we evaluated the quality of these 3 variables separately. 

```{r}
# format data for subplots 
data_cj_long <- data2 %>% select(prbarr, prbconv, prbpris) %>%
  gather(key = var, value = value)

# convert to factor for subplot labelling 
data_cj_long$var <- factor(data_cj_long$var, labels = c("Prob Arrest", "Prob Convicted", "Prob Sentenced"))
```

We can see that we have different distributions for these, but that they all could be considered somewhat close to normal, with different levels of skew. 

```{r}
# plot hist subplots
ggplot(data_cj_long, aes(value)) +
  geom_histogram(bins = 50) +
  facet_grid(~var) +
  theme_minimal() +
  ggtitle("Histogram of Criminal Justice Policy Variables: Assertiveness Variables")
```

From our boxplots we can see that we have some extreme values for assertiveness of conviction, with multiple counties having a rate above 1. As these are not true probabilities, but rather ratios, these values are not necessarily spurious. However, they imply that for each arrest, there could be multiple convictions - one county has over 2 convictions for every arrest. Only 1 county has more than 1 arrest per crime committed - most counties in fact have a much lower rate (and only put someone under arrest for about one-quarter of crimes). When it comes to setencing, counties show a much lower spread and cluster around 1 conviction resulting in a prison sentence for every 1 conviction that does not. 

```{r}
# plot boxplot subplots 
ggplot(data_cj_long, aes(x = var, y = value)) +
  geom_boxplot() +
  theme_minimal() +
  xlab("") +
  ylab("Ratio") + 
  ggtitle("Boxplot of Criminal Justice Policy Variables: Assertiveness Variables")
```

Which county had the highest conviction rate? This is a county in central North Carolina. It has the highest percentage of minorities. It also appears to have the maximum wages in the service industry ($2177.068 compared to a median of \$253.12). 

```{r}
data2 %>% filter(prbconv == max(prbconv))
```

The fact that the conviction rate is so high seems odd for county #185. The other measures of assertiveness (for arrest and sentencing) seem close to the mean. That of conviction rate is astronimically high. 

```{r}
data_prb <- data2 %>% as_tibble() %>% select(prbarr, prbconv, prbpris) %>% summarise_all(funs(median)) %>% 
  pivot_longer(c("prbarr","prbconv", "prbpris")) %>% mutate(Group = "Median")

prb_185 <- data2 %>%  as_tibble() %>% filter(county == 185) %>% select(prbarr, prbconv, prbpris) %>% 
  pivot_longer(c("prbarr","prbconv", "prbpris")) %>% mutate(Group = "County #185")

prbs <- bind_rows(data_prb, prb_185)

ggplot(data = prbs, aes(x = name, y = value, color = Group)) + 
  geom_point() +
  xlab('Criminal Justice Assertiveness Category') +
  ylab('Assertiveness') +
  theme_minimal() +
  ggtitle("Comparing Criminal Justice Efficiencies between County 185 and Other Counties")

```

Median is used instead of Mean as a statistic because the `prbconv` is not normally distributed. The analysis above suggests that the data for this county #185 may have been corrupted - since it has values for `wser` and `prbconv` at levels much higher than the median, whithout any explanation for why these might have both been elevated. Assuming that the number in county stands for the FIPS code, #185 stands for Warren County. During the 1980’s the citizens of Warren County conducted a series of demonstrations against a newly built landfill as per this [document](https://en.wikipedia.org/wiki/Warren_County_PCB_Landfill). These demonstrations led to multiple arrests and convictions that are not associated with crime but disobedience. As such, this county’s data will be excluded from subsequent modeling.

```{r}
data2 <- data2 %>% filter(county != 185)
print(paste("Number of records:", dim(data2)[1]))
```


Our dataset has a second kind of criminal justice system indicator, namely the average sentence of convictions (in days). While the assertiveness indicators relate to the certainty of punishment (the extent to which criminals expect to get caught and face punishment), average sentence relates to the severity of the punishment. We can see that average sentence length follows an approximately normal distribution. We have one value well above the rest (above 20; most cluster below 15). 

```{r, fig.width = 6, fig.align = "center"}
p1 <- ggplot(data2, aes(avgsen)) +
  geom_histogram(bins = 35) +
  theme_minimal() +
  xlab("Years of Imprisonment") +
  ylab("Count") +
  ggtitle("Histogram")

p2 <- ggplot(data2, aes(y = avgsen)) +
  geom_boxplot() +
  theme_minimal() +
  ylab("Years of Imprisonment") +
  ggtitle("Box plot")

grid.arrange(p1, p2, ncol = 2, top = "Criminal Justice Indicator: Average Sentence")
```

The county, Madison County, with the highest average sentence is in Western North Carolina.

```{r}
data2 %>% arrange(desc(avgsen)) %>% head(5)
```

##### Economic Policy

One of the things one can affect with economic policy are wages. In North Carolina in 1987, the minimum hourly wage was \$3.35. Given that most people work 40 hours per week, the minimum hourly wage would be \$134 per week.

In the plots below, we plot weekly wage by sector with a red vertical line indicating this minimum weekly wage.

We can see that `wrtd` (Wholesale/Retail/Trade) wages are closest to the minimum wage - which would suggest that wages in this sector would be most influenced by changes to the minimum wage. The next sector that would be influenced is `wser` (Service Industry). Additionally, `wser` may be a messier measure of income because many in that industry work in restaurants and make additional income through tips - however, some people may not report this income. Meanwhile, those working in Wholesale/Retail/Trade may be more likely to work in places like malls, which would not provide additional income as tips and would be a better measure of low-income wages. 

Note that most wages are approximately normally distributed.

```{r}
# format data for subplots 
data_ep_long <- data2 %>% 
  select(wcon, wtuc, wtrd, wfir, wser, wmfg, wfed, wsta, wloc) %>%
  gather(key = var, value = value)

data_ep_long$var <- factor(data_ep_long$var,
                           levels = c("wcon", "wtuc", "wtrd", "wfir",
                                      "wser", "wmfg", "wfed", "wsta", "wloc"),
                           labels = c("Construction", 
                                      "Utilities/Transport", 
                                      "Wholesale/Retail/Trade",
                                      "Finance/Insurance/Real Estate",
                                      "Service Industry",
                                      "Manufacturing",
                                      "Federal Emp",
                                      "State Emp",
                                      "Local/State Emp"))
```

```{r}
# plot hist subplots
ggplot(data_ep_long, aes(value)) +
  geom_histogram(bins = 50) +
  facet_wrap(~var) +
  theme_minimal() +
  ggtitle("Histogram of Economic Policy Variables: Wages by Sector") +
  geom_vline(aes(xintercept = 134, color = "red")) +
  theme(legend.position = "none")

```

```{r}
# plot boxplot subplots 
ggplot(data_ep_long, aes(x = var, y = value)) +
  geom_boxplot() +
  coord_flip() + 
  theme_minimal() +
  xlab("") + 
  ylab("Weekly Wage") +
  ggtitle("Boxplot of Economic Policy Variables: Wages by Sector")+
  geom_hline(aes(yintercept = 134, color = "red")) +
  theme(legend.position = "none")

```

Another variable influenced by economic policy is tax revenue per capita. As we noted above, this variable is confounded by wealth. However, you can also affect tax revenue by altering tax rates. 

The distribution of `taxpc` is positively skewed. This distribution coupled with the fact that `taxpc` is measured in dollars makes the variable a top candidate for a log transformation.

```{r, fig.width = 6, fig.align = "center"}
tax1 <- ggplot(data2, aes(taxpc)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  xlab("Tax Revenue Per Capita") +
  ylab("Count") +
  ggtitle("Histogram")

tax2 <- ggplot(data2, aes(y = taxpc)) +
  geom_boxplot() +
  theme_minimal() +
  ylab("Tax Revenue Per Capita") +
  ggtitle("Boxplot")

grid.arrange(tax1, tax2, ncol = 2, top = "Tax Revenue Per Capita")
```

We appear to have an extreme value at \$119.76, which is for county #55. We are missing information about whether this variable is west, central, or urban. 

```{r}
data2 %>% filter(taxpc == max(taxpc))
```

With such high tax revenue, one would expect that this county had higher wages. This county appears to have federal employee wages well below the mean for North Carolina. It is also below the median for:

* `wfir` (financial, insurance & real estate)
* `wmfg` (manufacturing)
* `wser` (service industry)
* `wtrd` (trade)

This seems suspect (combined with the fact that we lack information about its location). Based on our FIPS codes, county #55 could be Dare County. Via Google search, we can see that Dare County appears to be an island off the cost of North Carolina. This could explain some of the odd pattern we see in the wage and tax data, as well as why we are missing information about its location. 

Given that we do not have much background information on these counties, we will live county #55 in and monitor its effect on our model fits.

```{r}
data_tax <- data2 %>% as_tibble() %>% select(taxpc, wcon, wtuc, wtrd, wfir, wser, wmfg, wfed, wsta, wloc) %>% summarise_all(funs(median)) %>% 
  pivot_longer(c("taxpc", "wcon", "wtuc", "wtrd", "wfir", "wser", "wmfg", "wfed", "wsta", "wloc")) %>% mutate(Group = "Median")

taxes_55 <- data2 %>%  as_tibble() %>% filter(county == 55) %>% select(taxpc, wcon, wtuc, wtrd, wfir, wser, wmfg, wfed, wsta, wloc) %>% 
  pivot_longer(c("taxpc", "wcon", "wtuc", "wtrd", "wfir", "wser", "wmfg", "wfed", "wsta", "wloc")) %>% mutate(Group = "County #55")

taxes <- bind_rows(data_tax, taxes_55)

ggplot(data = taxes, aes(x = name, y = value, color = Group)) + 
  geom_point() +
  xlab('Category') +
  ylab('$') +
  theme_minimal() +
  ggtitle("Comparing Tax Revenue and Wages between County 55 and Other Counties")

```


#### Contextual Variables

##### Types of Crime 

```{r, fig.align = "center"}

# plot hist
p5 <- ggplot(data2, aes(mix)) +
  geom_histogram(bins = 35) +
  theme_minimal() +
  ggtitle("Histogram") +
  xlab("offense mix: face-to-face/other")

# plot boxplot
p6 <- ggplot(data2, aes(y = mix)) +
  geom_boxplot() +
  theme_minimal() +
  ggtitle("Boxplot") +
  ylab("offense mix")



grid.arrange(p5, p6, ncol = 2,  top = "Contextual Variables: Type of Crime")
```

##### Demographics 

*Density* 

One would expect density to be positively correlated with crime (more people packed together, more crime). 

- `density`:	people per sq. mile

*Minority status*

Minority status is likely positively correlated with crime. Race has a complicated relationship with the criminal justice system and we know that minorities are more likely to be involved. 

- `pctmin80`:	perc. minority, 1980 

*Gender & Age* 

Young males are more likely to be involved in the criminal justice system and we would expect this to positively correlate with crime. 

- `pctymle`:	percent young male, 1980

The distributions for `density` and `pctymle` approximate a normal distribution but the that of `pctmin80` approximates a uniform distribution. Minorities seems to be present in most counties on a similar proporties.

```{r, fig.align = "center"}

# hist
p7 <- ggplot(data2, aes(density)) +
  geom_histogram(bins = 35) +
  theme_minimal() +
  xlab("Density") +
  ylab("Count") +
  ggtitle("Population Density")

# plot boxplot
p8 <- ggplot(data2, aes(y = density)) +
  geom_boxplot() +
  theme_minimal() +
  ggtitle("Population Density") +
  ylab("Density")

p9 <- ggplot(data2, aes(pctmin80)) +
  geom_histogram(bins = 40) +
  theme_minimal() +
  xlab("% Minority") +
  ylab("Count") +
  ggtitle("Percentage Minority (1980)")

p10 <- ggplot(data2, aes(y = pctmin80)) +
  geom_boxplot() +
  theme_minimal() +
  ylab("% Minority") +
  ggtitle("Percentage Minority (1980)")

p11 <- ggplot(data2, aes(pctymle)) +
  geom_histogram(bins = 25) +
  theme_minimal() +
  xlab("% Young Males") +
  ylab("Count") +
  ggtitle("Percentage Young Male (1980)")

p12 <- ggplot(data2, aes(y = pctymle)) +
  geom_boxplot() +
  theme_minimal() +
  ylab("% Young Males") +
  ggtitle("Percentage Young Male (1980)")

grid.arrange(p7, p8, p9, p10, p11, p12, ncol = 2, nrow = 3,  top = "Contextual Variables: Demographics")
```

In terms of density outliers, we discovered that the county #199 has the highest density. This county probably is Mecklenburg County, which holds the city of Charlotte (the state capital and one of it's most populated cities).

```{r}
data2 %>% filter(density == max(density))
```

The smallest county would correspond to Martin County.

```{r}
data2 %>% filter(density == min(density))
```

In terms of "Percetage Young Male", county #133, Onslow county, is the main outlier. This deviation in % of young males could be due to Camp Lejeune, a marine corps base. Most recruits are young males and so this base would impact the % of young males in the population, epecially because the density of Onslow county is low. Contrary to the expected, the % of young males would have a negative impact on crime becuase recruits would most likely not commit crimes. However, this is not the only county in North Carolina with a military base, so we will be keeping this observation and monitoring it's impact on model results.

```{r}
data2 %>% filter(pctymle == max(pctymle))
```


##### Geography

```{r}
# format data for subplots 
data_geo_long <- data2 %>% select(west, central, urban) %>%
  gather(key = var, value = value)
```

The data shows that on average, 8% live in an urban area, 32% of people in the relevant counties live in the center of the state, 21% live in the west.

```{r}
# plot barplots
ggplot(data_geo_long, aes(value)) +
  geom_bar() +
  facet_grid(~var) +
  theme_minimal() +
  ggtitle("Barplot of Contextual Variables: Geography")
```

- `west`:	=1 if in western N.C.
- `central`:	=1 if in central N.C.
- `urban`:	=1 if in SMSA

Are these mutually exclusive categories? It appears that most counties have only one categorization. However, 7 counties have 2 and 33 have 0. 

```{r}
geo <- data2 %>% rowwise() %>% mutate(geo_sum = west + central + urban) 

table(geo$geo_sum, useNA = "always")
```

Most of these are central, urban counties. This makes sense because most urban centers in North Carolina are in its center or on its coast (towards the east). Only one is western and urban (County #21). According to the FIPS codes, this would be Buncombe County - which is in the west and contains the city of Asheville. This seems accurate. 

What about the one county that is listed as both western and central (County #71)? According to the FIPS codes, this is Gaston County. Based on Google search, this county looks like it could be either western or central North Carolina (it's on the edge). Perhaps this categorization is accurate. Nothing in the data dictionary tells us that these are mutually exclusive, therefore to limit our assumptions we will live this row as is for now while monitoring its influence on our modeling. 

```{r}
geo %>% filter(geo_sum == 2) %>% select(county, west, central, urban)
```

Using the FIPS codes and Google search, it appears that the counties that have all 0's for `west`, `central` and `urban` are in Eastern North Carolina. Thus, these appear to be valid rows. 

```{r}
geo %>% filter(geo_sum == 0) %>% select(county, west, central, urban)
```

We will prioritize `west` in our model, as Western North Carolina seems qualitatively different than other regions based on our research. There are less universities and different populations (e.g., many less minorities). The other categories may be important, but are likely less influential on crime patterns.

### Relationships between Variables

One would expect variables within each of the above groups to be correlated to each other. 

This is a correlation matrix of all of our variables, using Spearman's due to the fact that not all variables follow a normal distribution. 

As expected, `prbarr` and `prbconv`show a inverse correlation with `crmrte`. However, `prbpris` and `avgsen` do not show a strong correlation with `cmrte`. For the former, this low correlation could be due to lack of data points. In general, the number of impressionments is low,limiting our ability to establish a estable relationship between `prbpris` and `cmrte`. For the latter, given that most crimes committed are petty crimes with relatively low sentence lengths, average sentence length might not be a strong deterrant for crimes. 

Additionally, `mix` does not seem to have a strong correlation with `cmrte`. `mix` values are very low, indicating that face-to-face crimes are almost non-existant. Thus, the low sample size does not allow for a stable relationship between type of crime, as currently defined, and crime rate.

Our original policy variables for economic policy -- those related to wages -- appear to all be positively correlated with crime, which is opposite our original conjecture. Rather than seeing that increased wages are related to reduced crime, we are seeing that higher wages is related to higher crime. This unexpected direction could be explained in part by the strong positive relationship between the wage variables and `density` and between `crmrte` and `density`. Thus, we will not include the wage variables in early models - and it will be important to include additional variables to control for other influences that could be affecting the direction of this relationship. 

Population density has a strong relationshiop with crime rate. This relationship is expected as a greater number of poeple inherently increases the number of criminals and victims. Additionally, crime is expected to be lower in small communities because the level of integration is higher so the are more social deterrants against crime. `density` is also correlated with other geographical variables. For example, `urban` and `density` are positively correlated because cities will have higher density due to their urban design. We will pay special attention to these high correlations as they could increase the variation on models' residuals.

Finally, note that all wages as well as `taxpc` are positively correlated. This behaviour is expected as wages and taxable income are determined by economic factors, such as investment and living expenses, that should be shared by most industries in a given county. Similarly as above, we will need to pay close attention as the joint impact of including multiple variables in models that are highly correlated. 

```{r}
data_corr <- data2 %>% select(-county) 

matrix_corr <- round(cor(data_corr, method = "spearman"), 1)
```

```{r}
corrplot(matrix_corr, type = "lower", method = "ellipse", order = "alphabet")
```

## Results

We will next build a set of models to investigate our research question, documenting our decisions. 

### Model 1

Based on our exploration above, our dependent variable is *crime rate*, represented by the variable `crmrte`.

For our first model, we aimed to evaluate the relationship between crime policy and crime. Our initial null hypothesis is that crimal justice policies cannot explain the variation in crime rate.

We used the following independent variables to predict crime: 

*Crime policy* 

(1) log(`prbarr`)

(2) log(`prbconv`) 

(3) log(`prbpris`) 

(4) log(`avg_sen`)


#### Data Transformations

We decided to take the log of the crime policy measures and `crmrte` to improve our model fit and interpretability. With these variables logged, they can be interpreted as relative increases in crime rate and assertiveness of the criminal justice system (rather than their value alone). 

#### Discussion on results

Based on the variables' correlation findings, we compare the use of arrest, conviction, and sentencing rates (assertiveness measures) with just arrest and conviction rates. The scatterplots below appear to inidicate that both variables combinations are equally as good at explaining the variation on crime rate. This phenomenum could be due to the low variation in both `prbpris` and `avgsen` as discussed during the EDA portion of this research paper. Lower variation limits the amount of variation in crime rate an independent variable can explain.

```{r}
ggplot(data = data2, aes(x = log(crmrte), y = log(prbarr) + log(prbconv) + log(prbpris) + log(avgsen))) +
  geom_point() +
  theme_minimal()  +
  ggtitle("Relationship between Log Crime Rate and All Criminal Justice Policy variables") + 
  ylab("Log Crime Rate") + 
  xlab(NULL) +
  geom_smooth(method='lm', formula= y~x)
``` 

```{r}
ggplot(data = data2, aes(x = log(crmrte), y = log(prbarr) + log(prbconv))) +
  geom_point() +
  theme_minimal()  +
  ggtitle("Relationship between Log Crime Rate and Log Arrest & Log Conviction Rates") + 
  ylab("Log Crime Rate") + xlab("Log Arrest + Log Conviction Rates") +
  geom_smooth(method='lm', formula= y~x)
``` 

*CLM Assumptions*

Linear population model: This assumption is automatically fulfilled because we haven't constrained the error term, i.e we haven't required it to be normal. So there's nothing to check at this point.

Random Sampling: North Carolina has 100 counties and our dataset has only 90 of them. To check random sampling, we need background knowledge of how why these remaining 10 counties were ommited. Unfortunately, the assignment description does not explain it. In general, we may be concerned about possible problems with independence. For example, ommited counties are the poorest ones, for which it's more difficult to gather data. Perhaps, if these counties were in the sampe, we could capture better the effect of economic policy variables. 

No perfect collinearity: There is no need to explicitly check for perfect collinearity, because R will alert us if this rare condition happens.

Zero Conditional Mean: Notice that there is only a slight deviation from zero conditional mean, indicated by a not perfecly flat curve. However, since our sample size is greater than 30 we can invoke the Central Limit Theorem (CTL) to fulfill this assumption. 

```{r}
mod1_1 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(prbpris) + log(avgsen), data = data2)
plot(mod1_1, which = 1)
```

Normality of Errors: From the Q-Q plot, we see that our residuals approximate a normal distribution but with some noticeable negative skeness. We can also visually look at the residuals directly. Both methods suggest we have a leftward skew. However, we have a large sample size, so the CLT tells us that our estimators will have a normal sampling distribution. Our look at the histogram confirms that we aren't in a situation with an extreme skew, so n=88 should be sufficient for the CLT. We can rely on the (CTL) once again to fulfill this assumption.

```{r}
plot(mod1_1, which = 2)
```

```{r, warning=F, error=F}
hist(mod1_1$residuals, breaks = 20, main = "Residuals from Linear Model Predicting log(Crime Rate)")
```

Homoscedasticity: 

Our residuals versus fitted values plot seems to indicate heteroskedasticity - thickness for fitted values close to the mean seems to be larger. The scale location plot gives us another way to assess this assumption, and tells a similar story. Thus, we cannot fulfill this assumption. As a consequence, we will need to utilize robust standard error statistics to assess our models. Also, note that the heteroskedasticity could be pointing to omitted variables. We will address this specific issue in another section.

```{r}
plot(mod1_1, which = 3)
```

*Statistics Interpretation*

```{r, warning=F, error=F}
# model different variable combinations based on analysis performed
mod1_2 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(prbpris) , data = data2)
mod1 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) , data = data2)
```

In order to maintain parsimony on our assessment of coefficients, we will use "Adjusted R2" as the main indicator of statistical fit. R2 for a model could be missleading because it's value will increase automatically as the the number of variables increases. Thus, R2 is not an unbiased measure of statistical fit. In fact, targeting R2 could lead to over-fitting.

Approximately 39% of the variation in crime rate can be explained by the crimal justice policy variables. Note that only including  assertiveness of the criminal justice process (`prbarr`, `prbconv`, and `prbpris`) variables yields a similar R2. Increasing the ratio of criminal justice practices to crime (increasing arrests, convictions, and sentencing) could help decrease the crime rate. 

Coefficients on log(`prbpris`)  and log(`avg_sen`) were not statistically significant, thus we removed these variables to limit our total number of variables in the model to avoid overfitting. We already have important variables related to crime policy, thus including them isn't crucial. 

```{r, warning=F, error=F}
# generate robust standard errors

se_mod1_1 <- sqrt(diag(vcovHC(mod1_1)))
se_mod1_2 <- sqrt(diag(vcovHC(mod1_2)))
se_mod1 <- sqrt(diag(vcovHC(mod1)))

# produce regression table
stargazer(
  mod1_1
  , mod1_2
  , mod1
  , type = "text"
  , se = list(se_mod1_1, se_mod1_2, se_mod1)
  , star.cutoffs = c(0.05, 0.01, 0.001)
)
```

#### Outliers

One can see that there is one potential outlier that also has a lot of leverage on our model (observation #6). 

```{r}
ols_plot_resid_lev(mod1)
```

The outlier with leverage was in county #11. 

```{r}
data2 %>% filter(county == 11)
```

We can see that without this observation, we now explain slightly more of the variation (~44% compared to ~40%). 

```{r, warning = F, error = F}
data2_out <- data2 %>% filter(county != 11)

mod1_out <- lm(log(crmrte) ~ log(prbarr) + log(prbconv), data = data2_out)
se_mod1_out <- sqrt(diag(vcovHC(mod1_out)))
stargazer(mod1, mod1_out, type = "text" , se = list(se_mod1, se_mod1_out) , star.cutoffs = c(0.05, 0.01, 0.001))
```

Eliminating the outlier has improved our fit. However, we did not spot any data quality issues in this county during our exploratory data analysis. Futhermore, this leverage issue could also be fixed by including more covariates. We cannot claim that this record it has a data quality issue. We will continue to monitor it's leverage as we add more variables. 

*Conclusion*

There is enough evidence to reject our initial hypothesis. It seems that politians could leverage criminal justice policies to curb crime rate.

### Model 2

For our second model, we aimed to evaluate the relationship between crime and economic policies and context. Economic policy variables are those that politicians can impact directly while economic context variables can only be impacted indirectly. The main economic policy that politicians control is minimum wage and fiscal expenditure. As such, only the wages of industries whose average wage is close to the minimum wage will be included. Also, wages of government workers will be included. In light of the above, wages are only proxies of economic policies and as such conclusions from this test should be taken as hints for future research rather than strong evidence. For example, better research on minimum wage policy, such as [this](https://evans.uw.edu/policy-impact/minimum-wage-study), exists and should also be drawn upon when making decisions on minimum wage policy.

Our null hypothesis is that economic factors, such as minimum wage, do not explain variations on crime rate. These polcies impact depends on the economic context and as such we will also include these variables as covariates.

We used the following independent variables to predict crime: 

*Crime policy* 

(1) log(`prbarr`) 

(2) log(`prbconv`)

*Economic policy* 

(3) log(`wtrd`) 

(4) log(`wser`)

(5) log(`wloc`)

(6) log(`wsta`)

*Economic context*

(7) log(`wfed`) 

(8) log(`taxpc`)


#### Data Transformations

We decided to take the log of our wage variables to show the relationship between relative changes in these to crime (rather than the absolute number). This improves our interpretability since we are making policy recommendations around changing these relative to the existing levels in these counties. 

*Economic policy* 

We can see that we have a somewhat linear relationship between trade industry wages and crime. 

```{r}
ggplot(data = data2, aes(x = log(wtrd), y = log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Wholesale/Retail/Trade Wages") + 
  xlab("Average Weekly Wage") + ylab("Log Crime Rate") +
  geom_smooth(method='lm', formula= y~x)
```

The relationship between the log of Service Wages and Crime Rate seems fairly linear, though there are some outliers that have strong leverage on the relationship.

```{r}
ggplot(data = data2, aes(x = log(wser), log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Log Service Wages") + 
  xlab("Log Average Weekly Wage") + ylab("Log Crime Rate") +
  geom_smooth(method='lm', formula= y~x)
```

We can see that we have a relatively clear linear relationship between federal wages and crime. 

```{r}
ggplot(data = data2, aes(x = wfed, log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Federal Employee Wages") + 
   xlab("Average Weekly Wage") + ylab("Log Crime Rate") +
  geom_smooth(method='lm', formula= y~x)
```

Log transforming `wfed` does not improve the linearity of the relationship. We will model `wfed` with a log transformation because we are utilizing the variable as a proxy for living expenses. Log transforming would make the interpretation of the variable's coefficient more intuitive.

```{r}
ggplot(data = data2, aes(x = log(wfed), log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Federal Employee Wages") + 
   xlab("Log Average Weekly Wage") + ylab("Log Crime Rate") +
  geom_smooth(method='lm', formula= y~x)
```

We can see that we do not have a very linear relationship between tax per capita and crime. Many of the points cluster together, leaving little variability with which to predict crime. In order to address this cluster, we also apply a log transformation to the `taxpc` variable.

```{r}
ggplot(data = data2, aes(x = taxpc, log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Tax Per Capita") + 
  xlab("Tax Per Capita") + ylab("Log Crime Rate") +
  geom_smooth(method='lm', formula= y~x)
```

The fit appears slightly improved after logging tax per capital but the data seems to still be clustered. The variable will be log-transformed because we want it to act as a proxy for wealth level in a county and for that purpose the interpretation would be simpler.

```{r}
ggplot(data = data2, aes(x = log(taxpc), log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Log Tax Per Capita") + 
  xlab("Log Tax Per Capita") + ylab("Log Crime Rate") +
  geom_smooth(method='lm', formula= y~x)
```


#### Discussion on results

The first iteration of this model includes all crime justice variable as well as all economic policy and wealth variables.

```{r}
mod2_1 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wtrd) + log(wser) + log(wloc) + log(wsta) + log(wfed) + log(taxpc), data = data2)
```

*CLM Assumptions*

Zero Conditional Mean: The residuals not seem to be closer to zero than when only testing Criminal Justice policy variables. However, there are still some outliers that reduce our confidence on fulfilling this assumption. However, thanks to our sample size we can invoke the CTL to fulfill this assumption.

```{r}
plot(mod2_1, which = 1)
```

Normality of Errors: The residuals suffer from both postive and negative skewness. As such, we cannot be confident that the model fulfills this assumption. However, once again we can invoke the CTL to fulfill this assumption.

```{r}
plot(mod2_1, which = 2)
```

Homoscedasticity: The model does not fulfill this assumption. We will need to utilize robust statistics to assess this model.

```{r}
plot(mod2_1, which = 3)
```

*Statistics Interpretation*

All economic context variables had statistically significant relationships to crime rate but none of the economic policy variables did. Even after considering interactions with economic context variables, economic policies do not seem to have an impact on crime rate. We also conducted a F-test to determine if adding economic policy and context variables were jointly significant at explaining the variation on crime rate. The p-value of the test led us to reject the null hypothesis that the economic policy and context variables jointly do not help explain the variance on crime rate. In addition, we tested the joint significance of only the economic context variables, achieving a similar conclusion. Finally, we tested the joint signficance of two economic variables representing wage and fiscal policies but the results of the test corroborated the conclusion that these variables were not significant. 

Nevertheless, we decided to keep one proxy for wage policies, Services Wages, and one proxy for fiscal policy, State Employees because they did not have a negative impact on model fit as shown by the adjusted R2. We expect that these variables will become more signficant as we test more variables. For example, wages are impacted by density as living cost would be higher. Also, minorities are known to have lower wages. Adding demographic variables could change the statistical significance of economic policy variables.

The estimated relationship between `taxpc` and `wfed` with `crmrte` was statistically significant but positive. This indicates crime rate is larger in wealthier with higher cost of living counties which is intuitive. Currently, these variables could be capturing part of the crime rate variation that should be captured by demographic variables such as `density`. We expect the coefficients for this values to fluctuate slightly as we add more variales.

```{r}
# F-test: joint significance of economic policy variables
print("F-test results for joint significance of economic policies") 
linearHypothesis(mod2_1, c("log(wser)=0", "log(wsta)=0", "log(wtrd)=0", "log(wloc)=0", "log(wfed)=0", "log(taxpc)=0"), vcov=vcovHC)
```

```{r, warning=F, error=F}
# fit models
mod2_2 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wfed) + log(taxpc), data = data2)  # no economic policy variables
mod2_3 <- lm(log(crmrte) ~ log(prbarr)*log(wfed) + log(prbconv)*log(wfed) + log(wser)*log(wfed) + log(wsta)*log(wfed) + log(taxpc), data = data2)  # taxpc interactions
mod2_4 <- lm(log(crmrte) ~ log(prbarr)*log(taxpc) + log(prbconv)*log(taxpc) + log(wser)*log(taxpc) + log(wsta)*log(taxpc) + wfed, data = data2)  # wfed interactions
mod2 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc), data = data2)   # some economic policy variables, no interactions

# generate robust standard errors
se_mod2_1 <- sqrt(diag(vcovHC(mod2_1)))
se_mod2_2 <- sqrt(diag(vcovHC(mod2_2)))
se_mod2_3 <- sqrt(diag(vcovHC(mod2_3)))
se_mod2_4 <- sqrt(diag(vcovHC(mod2_4)))
se_mod2 <- sqrt(diag(vcovHC(mod2)))

# produce regression table
stargazer(
    mod2_1
  , mod2_2
  , mod2_3
  , mod2_4
  , mod2
  , type = "text"
  , se = list(se_mod2_1, se_mod2_2, se_mod2_3, se_mod2_4, se_mod2)
  , star.cutoffs = c(0.05, 0.01, 0.001)
  )
```

```{r}
# F-test: joint significance of economic context variables
print("F-test results for joint significance of economic policies") 
linearHypothesis(mod2_1, c("log(wfed)=0", "log(taxpc)=0"), vcov=vcovHC)
```

```{r}
# F-test: joint significance of economic context variables
print("F-test results for joint significance of economic policies") 
linearHypothesis(mod2, c("log(wser)=0", "log(wsta)=0"), vcov=vcovHC)
```

#### Outliers

Once again, county #11 (observation #6) appears to be an outlier with leverage. Note that it's leverage has decreased as we increased more variables. We expect the leverage of the outlier to decrease as we add more variables that explain the variation in the residuals.

```{r}
ols_plot_resid_lev(mod2)
```

We can see that without this observation, we now explain slightly more of the variation (~57% compared to ~53%). 

```{r, warning = F, error = F}
data2_out <- data2 %>% filter(county != 11)

mod2_out <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc), data = data2_out)
se_mod2_out <- sqrt(diag(vcovHC(mod2_out)))
stargazer(mod2, mod2_out,  type = "text", se = list(se_mod2, se_mod2_out) , star.cutoffs = c(0.05, 0.01, 0.001))
```

Although eliminating the outlier has improved our fit and this outlier has leverage, we do not have any reason to suspect that it has data quality issues.

*Conclusion*

We fail to reject null hypothesis that economic policy variables are not significant in explaining the variation on crime rate. It seems that politicians might not be able to use economic policy variables to impact crime rate, at least in the short-term.


### Model 3

For our third model, we added demographic control variables to evaluate the robustness of the relationship between crime policy, economic policy, and crime rate when controlling for key demographic factors.

In addition, we will test the null hypothesis that demographic factors do not impact the relationship between criminal justice and economic policy with crime rate.

We used the following independent variables to predict crime: 

*Crime policy* 

(1) log(`prbarr`) 

(2) log(`prbconv`)

*Economic policy* 

(4) log(`wser`)

(6) log(`wsta`)

*Economic context*

(7) log(`wfed`) 

(8) log(`taxpc`)

*Demographic* 

(6) `density` - higher density means more opportunity for crime to be committed and reported; denser areas also tend to have more economic activity and so this variable could be related to wages 

(8) `pctymle` - young males are more likely to commit crimes and thus areas with higher portions of this type of person may see more crime regardless of their policies 

(9) `pctmin80` - minorities are likelier to be arrested and convicted (and from a lot of research we know that this is not always related to their likelihood to commit a crime)


#### Data Transformations

Many of the contextual variables (`density`, `mix`, `pctymle`) showed a pattern where most counties clustered closely together. Logging them did not improve their fit. This similar pattern may be an artefact of North Carolina being a small state that may have limited variation across counties on some elements (like density, crime patterns in terms of their type, and percent young male). 

##### Density

Taking the log of density improves its linear fit to crime rate. 

```{r}
ggplot(data = data2, aes(x = density, log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Density") + 
  ylab("Log Crime Rate") + xlab("People per Sq. Mile") +
  geom_smooth(method='lm', formula= y~x)
```

```{r}
ggplot(data = data2, aes(x = log(density), log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Log Density") + 
  ylab("Log Crime Rate") + xlab("Log People per Sq. Mile") +
  geom_smooth(method='lm', formula= y~x)
```

##### Percent Young Male in 1980

Perecent Young Male does not seem to have a linear relationship with crime rate. However, it could prove to be a useful covariate. Log-transforming Percent Young Male did not improve the linear relationship with crime rate.

```{r}
ggplot(data = data2, aes(x = pctymle, log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Percent Young Male") + 
  ylab("Log Crime Rate") + xlab("% Young Male") +
  geom_smooth(method='lm', formula= y~x)
```

```{r}
ggplot(data = data2, aes(x = log(pctymle), log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Log Percent Young Male") + 
  ylab("Log Crime Rate") + xlab("Log % Young Male") +
  geom_smooth(method='lm', formula= y~x)
```

##### Percent Minority

The percent minority in 1980 does not have a strong relationship to crime. Counties appear to have a wide range of this variable and there is a slight positive relationship to crime rate. We noticed an slight concave form on the scatterplot so we tried a quadratic transformation. The linearity did not seem to improve but we will test both forms in the model. 

```{r}
ggplot(data = data2, aes(x = pctmin80, log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Percent Minority") + 
  ylab("Log Crime Rate") + xlab("% Minority") +
  geom_smooth(method='lm', formula= y~x)
```

```{r}
ggplot(data = data2, aes(x = pctmin80*pctmin80, log(crmrte))) +
  geom_point() +
  theme_minimal() +
  ggtitle("Relationship between Crime Rate and Log Percent Minority") + 
  ylab("Log Crime Rate") + xlab("Log % Minority") +
  geom_smooth(method='lm', formula= y~x)
```


#### Discussion of results 

*CLM Assumptions*

Zero Conditional Mean: Although the errors don't seem to hover close to zero, we fulfill this assumption by invoking the CLT. 

```{r}
mod3_1<- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle, data = data2)
plot(mod3_1, which = 1)
```

Normality of Errors: Although residuals suffer from positive and negative skewness, we fulfill this assumption by invoking the CLT.

```{r}
plot(mod3_1, which = 2)
```

Homoskedasticity: We fail to meet this assumption so we will continue to use robust statistics.

```{r}
plot(mod3_1, which = 3)
```

*Statistics Interpretation*

The first iteration includes all the variables. The model fit increased dramatically in comparison to mod2. A F-test was conduced with results leading us to reject the null that the demographic variables are not jointly significant. From all the variables includes, only `pctymle` is not individually significant. On the next iteration we dropped `pctymle` but the model fit drops. That means that even though the coefficient for that variable is not significant and we should be careful when interpreting it, including the variable does improve the overall model fit. 

Including factors related to the demographics of an area (density; percent young males; and percent minorities) increases our ability to predict crime. Thus, these factors should be part of policy considerations we recommended above. Higher rates of any of these are related to higher levels of crime.

We tested the joint significance of economic policies and once again we fail to reject the null hypothesis. The economic policy proxies that we have available do not seem to be statistically significant in explaning the variation in crime rate. We would need to do more external research on the economic policies ran in North Caroline during the time the data callection occured to determine why these proxies are not significant. Including the variable in the model does improve the overall fit of the model so we will continue to include them as wages covariates.

```{r}
# F-test: joint significance of demographic variables
print("F-test results for joint significance of economic policies") 
linearHypothesis(mod3_1, c("density=0", "pctmin80=0", "pctymle=0"), vcov=vcovHC)
```

```{r, warning=F, error=F}
# fit models
mod3_2 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80*pctmin80 + pctymle, data = data2)  # pctmin80 quadratic transform
mod3_3 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 , data = data2)  # no pctymle
mod3_4 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle, data = data2)  # no wages

# generate robust standard errors
se_mod3_1 <- sqrt(diag(vcovHC(mod3_1)))
se_mod3_2 <- sqrt(diag(vcovHC(mod3_2)))
se_mod3_3 <- sqrt(diag(vcovHC(mod3_3)))
se_mod3_4 <- sqrt(diag(vcovHC(mod3_4)))

# produce regression table
stargazer(
    mod3_1
  , mod3_2
  , mod3_3
  , mod3_4
  , type = "text"
  , se = list(se_mod3_1, se_mod3_2, se_mod3_3, se_mod3_4)
  , star.cutoffs = c(0.05, 0.01, 0.001)
)

mod3 <- mod3_1
se_mod3 <- se_mod3_1
```

```{r}
# F-test: joint significance of demographic variables
print("F-test results for joint significance of economic policies") 
linearHypothesis(mod3, c("log(wser)=0", "log(wsta)=0"), vcov=vcovHC)
```

#### Outliers

One can see that there are two potential outliers that also have leverage on our model (observations #25). We also have one borderline case. Note that observation #6's leverage has dropped.

```{r}
ols_plot_resid_lev(mod3)
```

Once again, County #55 appears to be an outlier with leverage. It seemed as though County #55 was truly an extreme case whose pattern might be reasonable (since it could be an odd island off the coast of North Carolina).

```{r}
data2 %>% filter(county == 55)
```

We can see that without these observations, we now explain a lot more of the variation (~76% compared to ~71%).

```{r, warning = F, error = F}
data2_out <- data2 %>%  filter(county != 55)

mod3_out <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle, data = data2_out) 

se_mod3_out <- sqrt(diag(vcovHC(mod3_out)))

stargazer(
    mod3
  , mod3_out
  , type = "text"
  , se = list(se_mod3, se_mod3_out)
  , star.cutoffs = c(0.05, 0.01, 0.001)
)
```

Although eliminating the outlier has improved our fit we do not have any reason to suspect that they have data quality issues. Note that `log(wsta)` has become significant.

*Conclusion*

We partially reject the null hypothesis that demographic covariates do not impact the effect of criminal justice and economic policies on crime rate. It seems that demographic factors do impact the effect that criminal justice policies have on crime rate but we cannot conclude the same for economic policies. Politicians will need to adjust their policies depending on the demographic characteristics of a county.


### Model 4

For our fourth model, we aimed to evaluate the robustness of the relationship between crime policy and crime when controlling for economic, demographic, and geographic context variables. In addition, we will also re-test the impact of economic policy on crime rate. The null hypothesis for this iteration is that geographical characteristics of a county do not impact the relationship between the criminal justice and economic policy variables and crime rate.

We used the following independent variables to predict crime: 

*Crime policy* 

(1) log(`prbarr`) 

(2) log(`prbconv`)

*Economic policy* 

(4) log(`wser`)

(6) log(`wsta`)

*Economic context*

(7) log(`wfed`) 

(8) log(`taxpc`)

*Demographic* 

(6) `density` - higher density means more opportunity for crime to be committed and reported; denser areas also tend to have more economic activity and so this variable could be related to wages 

(8) `pctymle` - young males are more likely to commit crimes and thus areas with higher portions of this type of person may see more crime regardless of their policies 

(9) `pctmin80` - minorities are likelier to be arrested and convicted (and from a lot of research we know that this is not always related to their likelihood to commit a crime)

*Geographic*

(10) `west` - Western North Carolina is potentially very different from other regions in North Carolina, as we noted at the beginning of this report. A different culture could relate to different crime patterns and relationships between crime and other factors. For example, this variable is highly related to `pctmin80` (Western counties have lower levels of minorities) and this could affect crime rate through differences in diversity. 

(11) `central`

(12) `urban`


#### Discussion on results

The crime rate for central and not central counties is fairly similar. Thus, we don't expect this covariate to be significant. The crime rate has more variance when the counties are grouped by west and non-west. So, we expect `west` to have higher chances of being statistically. The greatest variance on crime rate is observed when the data is grouped by urban and non-urban. However, `urban` and `density` are highly correlated as seen early, so adding `urban` to the model formula my not improve fits.

```{r, warning = F, error = F}
gg_central <- ggplot(data = data2, aes(x = central, crmrte)) + 
  geom_bar(stat = "summary", fun.y = "mean") + 
  theme_minimal() + 
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  ggtitle("Central Counties") + 
  ylab("Crime Rate") + 
  xlab("West (0 = no; 1 = yes)") +
  ylim(c(0,0.08))

gg_west <- ggplot(data = data2, aes(x = west, crmrte)) + 
  geom_bar(stat = "summary", fun.y = "mean") + 
  theme_minimal() + 
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  ggtitle("Western Counties") + 
  ylab("Crime Rate") + 
  xlab("West (0 = no; 1 = yes)") +
  ylim(c(0,0.08))

gg_urban <- ggplot(data = data2, aes(x = urban, crmrte)) + 
  geom_bar(stat = "summary", fun.y = "mean") + 
  theme_minimal() + 
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  ggtitle("Urban Counties") + 
  ylab("Crime Rate") + 
  xlab("West (0 = no; 1 = yes)") +
  ylim(c(0,0.08))

grid.arrange(gg_central, gg_west, gg_urban, ncol = 3,  top = "Relationship between Crime Rate and Geographical Variables")
```


*CLM Assumptions*

Zero Conditional Mean: The plot below does not give us confidence that we meet this assumption. We see some clustering at the middle of the plot. However, we fulfill this assumption by invoking the CLT.

```{r, warning=F, error=F}
mod4_1 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle + west + central + urban, data = data2)
plot(mod4_1, which = 1)
```

Normality of Errors: The Q-Q plot shows positive and negative skewness, so it doesn't indicate that we are fulfilling this assumption. However, we can fulfill this assumption by invoking the CLT.

```{r}
plot(mod4_1, which = 2)
```

Homoskedasticity: The variance of the residuals clearly don't have an uniform variace for all fitted values. The model does not fulfill this assumption, so we will need to conduct robust statistical testing.

```{r}
plot(mod4_1, which = 3)
```


*Statistics Interpretation*

We can see that our additions did not improve our model fit. Further, we can conclude from the F-test that geographical variables are not jointly significant. 

Interactions with the `west` and `central` variable yield the most improvement in model fit. However, the interaction variables are not significant and as such will not be included becuase doing so would decrease our confidence on criminal justice policy coefficients' interpretation.

Although, including `west` in the model formula does not improve adjusted R2, we chose to include it based on the interactions and external research. Recall that this area of the state has less cities and universities. We have reason to believe that live in west North Carolina is significantly different than in non-west North Carolina.

```{r}
# F-test: joint significance of geographic characteristics
print("F-test results for joint significance of geograhpic characteristics") 
linearHypothesis(mod4_1, c("west=0", "central=0", "urban=0"), vcov=vcovHC)
```

```{r, warning=F, error=F}
# fit models
mod4_2 <- lm(log(crmrte) ~ log(prbarr)*west + log(prbconv)*west + log(prbarr)*central + log(prbconv)*central + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle, data = data2)   # west and central interaction
mod4_3 <- lm(log(crmrte) ~ log(prbarr)*urban + log(prbconv)*urban + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle, data = data2)  # urban interactions
mod4_4 <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + west + pctmin80 + pctymle, data = data2)  # west only, no interactions
mod4_5 <- lm(log(crmrte) ~ log(prbarr)*west + log(prbconv)*west + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle, data = data2)  # west only, interactions

# generate robust standard errors
se_mod4_1 <- sqrt(diag(vcovHC(mod4_1)))
se_mod4_2 <- sqrt(diag(vcovHC(mod4_2)))
se_mod4_3 <- sqrt(diag(vcovHC(mod4_3)))
se_mod4_4 <- sqrt(diag(vcovHC(mod4_4)))
se_mod4_5 <- sqrt(diag(vcovHC(mod4_5)))

# produce regression table
stargazer(
    mod4_1
  , mod4_2
  , mod4_3
  , mod4_4
  , mod4_5
  , type = "text"
  , se = list(se_mod4_1, se_mod4_2, se_mod4_3, se_mod4_4, se_mod4_5)
  , star.cutoffs = c(0.05, 0.01, 0.001)
)


mod4 <- mod4_4
se_mod4 <- se_mod4_4
```


*Conclusion*

We fail reject the null hypothesis that geographic covariates do not explain variations on crime rate. It seems that geographic factors do not impact the effect that criminal justice or economic policies have on crime rate. Politicians do not need to tailor their policies to curb crime rate by county geography.

#### Outliers

One can see that there is one potential outlier that also has a lot of leverage on our model. 

```{r}
ols_plot_resid_lev(mod4)
```

Once again, county #55 appears to be an outlier with leverage.  

```{r}
data2 %>% filter(county == 55)
```

We can see that without this observation, we now explain slightly more of the variation (~76% compared to ~71%). 

```{r, warning = F, error = F}
data2_out <- data2 %>% filter(county != 55)

mod4_out <- lm(log(crmrte) ~ log(prbarr) + log(prbconv) + log(wser) + log(wsta) + log(wfed) + log(taxpc) + density + pctmin80 + pctymle + west, data = data2_out)
se_mod4_out <- sqrt(diag(vcovHC(mod4_out)))

stargazer(
  mod4
  , mod4_out
  , type = "text"
  , se = list(se_mod4, se_mod4_out)
  , star.cutoffs = c(0.05, 0.01, 0.001)
)
```

Although eliminating the outlier has improved our fit, and although this outlier has leverage, we do not have any reason to suspect that it has data quality issues.

## Regression Table

Coefficient interpretation: TBD

```{r, warning=F, error=F}
stargazer(
    mod1
  , mod2
  , mod3
  , mod4
  , type = "text"
  , se = list(se_mod4, se_mod4, se_mod4, se_mod4)
  , star.cutoffs = c(0.05, 0.01, 0.001)
)
```


# A Discussion of Other Possible Omitted Variables

Omitted variables can change the strength of relationships between our independent and dependent variables. The lack of homoskedasticity is an indicator that our observed model is omitting important variables.

```{r}
plot(mod4, which = 3)
```

We lacked many variables related to community-level elements that would be expected to affect crime. Could any of these have affected the quantification of the relationships above? 

**Unemployment** 
TBD

**Education levels of the populace** 

Although we may be able to proxy education levels by looking at which region a county is in, we would not have a very good measure of overall education levels. A county can have a university, but still have low education levels overall. One would predict that education is negatively related to crime - the more educated, the less crime one would expect to see. Education levels would be positively correlated to wages and cost of living. It's unclear what direction the relationship would be to the distribution of minorities, or to criminal justice practice. Thus, one would guess that the bias would be towards zero (positive relationship to wages * negative relationship to crime = negative). This means that if anything omitting this variable would have diminished the measure of relationships.

**Public works & investments** 

One would predict that, like education, the relationship between and public works and investments would be negative. More nonprofits and community organizations could strengthen ties in communities, thus lowering crime rates. This factor would probably be inversely related to arrest and conviction rates, since a more punitive society may invest less in rewards to the community. It would probably be positively related to wages, since more money means more funds available to invest back. The direction of the relationship to the distribution of minorities is unclear. Thus, one would guess that the bias would be towards zero (negative relationship to arrest rate * negative relationship to conviction rate * positive relationship to wages * negative relationship to crime = negative).  

**Individual Health (mental and physical)** 

Individual health - both mental and physical - would likely be related to less crime. The healthier you are, the more mental and physical resources you have to solve problems in ways that do not necessitate committing a crime. One would expect this factor to be positively related to wages but negatively related to percent minorities (racism has negative impacts on health). The direction of the relationship to arrest or conviction rates is unclear. The direction of the relationship to density could go either way - people in cities may have access to better and more accessible health care, but live in a more polluted environment. Thus, one would guess that the bias would be away from zero (positive relationship to wages * negative relationship to percent minority * negative relationship to crime = positive). This could have elevated the quantification of our relationships above. Could better individual health be the hidden variable that is influencing our relationship to federal wages (our proxy for cost of living)? 

**Community Health**

Community health is about the cohesiveness of a community. If you have good supports in your community, you would be less likely to commit crime. The relationship to wages is unclear - communities at many income levels can have loving, supportive relationships. It is unclear what the relationship would be to percent minorities. This factor would probably be inversely related to arrest and conviction rates, since a more loving, cohesive community may be less likely to turn to punishment. Thus, one would guess that the bias would be towards zero (negative relationship to arrest rate * negative relationship to conviction rate * negative relationship to crime = negative).

**Inequality** 

We only had measures of average wage by sector in each county. We don't have information about the distribution within and across these sectors. With more inequality, one would expect to see more crime - more anger & therefore reason to commit crime combined with greater levels of deprivation & need to commit crime would naturally lead to more crime. The direction of the relationship between inequality and any of our independent variables in our final model is unclear - thus it is difficult to tell what direction this bias would be in. 

# Conclusion

Based on our dataset, our analyses suggest that acting on crime deterrants within the criminal justice system (like arrests and convictions) is important policy efforts to take when it comes to preventing crime. Helpful follow-ups in this investigation would be to leverage variation across time for conducting a difference-in-differences test or large changes in policy that would help with regression discontinuity. However, our findings can be used to hone in on future policy changes that can be evaluated with more rigorous causal analyses. 

It would also be helpful to follow-up on this investigation with the addition of health variables. These omitted variables could have affected the relationships tested here. Specifically, areas with higher cost of living may have people living there with better health care and less stress, which would make them healthier and give them less reason to commit crimes. 

Other factors outside of policy -- such as the distribution of minorities -- are also important when it comes to crime. Communities with higher rates of either may require additional resources or different types of policies to prevent crime. For example, if the actual number of crimes is different from the number of reported crimes -- for example, in a community with a lot of racial conflict where some groups over-report others to the police -- we would see elevated measures of crime. If policies aim to reduce actual crime (rather than just reported crime), we would need more nuanced measures to track these and would need to turn towards more nuanced ways to address this (perhaps through strenghening group cohesiveness and hosting workshops to reduce racism). 

Some policies could include: 

* Improved training and hiring of criminal justice staff, that could improve the ratio of arrest and convictions to crimes. Making sure that those who commit crimes are caught seems to be important in deterring crime - whether by keeping people off the streets, rehabilitating them, or scaring others away from commiting crimes 

* Even though we could not find much support for the importance of economic policy variables to prevent crimes, measures to improve living conditions locally should not detract from efforts on the criminal justice system front. Targeting economic development policies that can bring higher wages and improve the quality of life in a region is likely important to deter crime. We did find that the wages of federal employees appear positively correlated with crime - one would imagine that counties would not intend to enact policies that depress wages in their region. There are likely hidden or unmeasured factors (such as health, inequality, corruption, or high cost of living without investent back into the community) that could be driving this effect. 

* We found that communities with higher density of minorities have higher rates of crime. More follow-up would be needed to investigate mediators of this effect - such as racism, which could lead to higher rates of reported crime (even when holding actual crime constant) - but efforts towards community investments such as those related to the economic development efforts could also be used to fight crime. 

* Both of these streams (criminal and economic reform) could be folded under the umbrella of investing more in one's community. It is not enough to punish and deter - one needs to also get at the root causes of crime and why someone may be compelled to commit a crime in the first place. The fact that crime is higher with high rates of minorities suggests that the picture is more complicated than it may seem when looking at crime policy variables. Are there elements of community cohesion that could be improved to help reduce crime? Or efforts to mitigate the systemic effects of racism? Perhaps more crimes are simply reported in those areas - so the elevate numbers are not truly a reflection of actual crime committed but rather enhanced surveillance. 



